<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Raksha Ultimate</title>

<style>
body{
font-family:Arial;
background:#0f172a;
color:white;
text-align:center;
padding:15px;
}
h2{margin-bottom:5px;}
.btn{
width:95%;
padding:16px;
margin:8px;
font-size:17px;
border:none;
border-radius:12px;
color:white;
font-weight:bold;
}
.red{background:#e53935;}
.blue{background:#1e88e5;}
.green{background:#43a047;}
.orange{background:#fb8c00;}
.box{
background:#1e293b;
padding:15px;
border-radius:12px;
margin-top:15px;
}
input{
width:95%;
padding:10px;
margin:6px;
border-radius:6px;
border:none;
font-size:15px;
}
</style>
</head>

<body>

<h2>ğŸ›¡ï¸ RAKSHA ULTIMATE</h2>
<p>India Safety System</p>

<button class="btn red" onclick="startEmergency('Manual SOS')">ğŸ†˜ SOS</button>
<button class="btn blue" onclick="fakeCall()">ğŸ“ Fake Call Escape</button>
<button class="btn green" onclick="manualLocation()">ğŸ“ Share Location</button>
<button class="btn orange" onclick="toggleGuard()">ğŸ›¡ï¸ Guard Mode</button>

<div class="box">
<h3>âš™ï¸ Setup (One Time)</h3>

<input id="chatid" placeholder="Telegram Chat ID">
<input id="phone" placeholder="Emergency Phone +91...">
<input id="dangerlat" placeholder="Danger Zone Lat">
<input id="dangerlon" placeholder="Danger Zone Lon">

<button class="btn blue" onclick="saveSettings()">Save Settings</button>
<p id="saved" style="display:none;color:lightgreen;">Saved âœ…</p>
</div>

<script>
const BOT_TOKEN="8378037937:AAGjuFdZWLnf0kFfTG_QIFCslgvrDMb-sC4"; // â† only bot token fixed

let guardActive=false;
let emergencyActive=false;

// ---------- LOAD SETTINGS ----------
window.onload=function(){
 document.getElementById("chatid").value=localStorage.getItem("chatid")||"";
 document.getElementById("phone").value=localStorage.getItem("phone")||"";
 document.getElementById("dangerlat").value=localStorage.getItem("dlat")||"";
 document.getElementById("dangerlon").value=localStorage.getItem("dlon")||"";
};

// ---------- SAVE ----------
function saveSettings(){
 localStorage.setItem("chatid",document.getElementById("chatid").value);
 localStorage.setItem("phone",document.getElementById("phone").value);
 localStorage.setItem("dlat",document.getElementById("dangerlat").value);
 localStorage.setItem("dlon",document.getElementById("dangerlon").value);
 document.getElementById("saved").style.display="block";
}

// ---------- GETTERS ----------
function getChat(){ return localStorage.getItem("chatid"); }
function getPhone(){ return localStorage.getItem("phone"); }

// ---------- FAKE CALL ----------
function fakeCall(){
 let caller=prompt("Caller name","Papa");
 let audio=new Audio("https://actions.google.com/sounds/v1/alarms/phone_alerts_and_rings.ogg");
 audio.loop=true;
 audio.play();
 navigator.vibrate([500,300,500]);

 let div=document.createElement("div");
 div.style="position:fixed;top:0;left:0;width:100%;height:100%;background:black;color:white;display:flex;align-items:center;justify-content:center;font-size:30px;z-index:99999";
 div.innerHTML="ğŸ“ "+caller+" Calling...";
 document.body.appendChild(div);

 setTimeout(()=>{audio.pause();location.reload();},15000);
}

// ---------- VOLUME BUTTON SOS ----------
let vol=0; let timer;
window.addEventListener("keydown",e=>{
 if(e.key==="AudioVolumeUp" || e.keyCode===175){
  vol++;
  if(vol>=3){ startEmergency("Quick Button SOS"); vol=0;}
  clearTimeout(timer);
  timer=setTimeout(()=>vol=0,2000);
 }
});

// ---------- EMERGENCY ----------
function startEmergency(reason){
 if(emergencyActive) return;
 emergencyActive=true;
 navigator.vibrate([1000,300,1000]);

 navigator.geolocation.getCurrentPosition(pos=>{
  let lat=pos.coords.latitude;
  let lon=pos.coords.longitude;
  let link=`https://maps.google.com/?q=${lat},${lon}`;
  let msg=`ğŸš¨ SOS: ${reason}\nğŸ“ ${link}`;

  if(navigator.onLine){
   fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${getChat()}&text=${encodeURIComponent(msg)}`);
   sendLocation(lat,lon);
   startAudioRecord();
  }else{
   window.location.href=`sms:${getPhone()}?body=${encodeURIComponent(msg)}`;
  }
 });
}

// ---------- SEND LOCATION ----------
function sendLocation(lat,lon){
 fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation?chat_id=${getChat()}&latitude=${lat}&longitude=${lon}`);
}

// ---------- AUDIO RECORD ----------
async function startAudioRecord(){
 try{
 const stream=await navigator.mediaDevices.getUserMedia({audio:true});
 let rec=new MediaRecorder(stream);
 let chunks=[];
 rec.ondataavailable=e=>chunks.push(e.data);
 rec.start();
 setTimeout(()=>rec.stop(),15000);

 rec.onstop=()=>{
  let blob=new Blob(chunks,{type:"audio/ogg"});
  let fd=new FormData();
  fd.append("chat_id",getChat());
  fd.append("audio",blob,"evidence.ogg");

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendAudio`,{
    method:"POST", body:fd
  });
 }
 }catch(e){}
}

// ---------- LOCATION SHARE ----------
function manualLocation(){
 navigator.geolocation.getCurrentPosition(pos=>{
  let link=`https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
  window.location.href=`https://wa.me/?text=${encodeURIComponent("My location: "+link)}`;
 });
}

// ---------- GUARD MODE ----------
function toggleGuard(){
 guardActive=!guardActive;
 if(guardActive){
  alert("Guard Mode ON");
  startDangerWatch();
 }else location.reload();
}

// ---------- DANGER ZONE ----------
function startDangerWatch(){
 navigator.geolocation.watchPosition(pos=>{
  let dlat=parseFloat(localStorage.getItem("dlat"));
  let dlon=parseFloat(localStorage.getItem("dlon"));
  if(!dlat||!dlon) return;

  let d=distance(pos.coords.latitude,pos.coords.longitude,dlat,dlon);
  if(d<0.4){
   alert("âš ï¸ Entered Unsafe Area");
   navigator.vibrate([500,200,500]);
  }
 });
}

function distance(lat1,lon1,lat2,lon2){
 const R=6371;
 const dLat=(lat2-lat1)*Math.PI/180;
 const dLon=(lon2-lon1)*Math.PI/180;
 const a=Math.sin(dLat/2)*Math.sin(dLat/2)+
 Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
 Math.sin(dLon/2)*Math.sin(dLon/2);
 return R*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));
}
</script>
</body>
</html>
